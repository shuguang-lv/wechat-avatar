{"version":3,"sources":["uni-app:///main.js",null,"webpack:///F:/wechat-avatar/pages/main/index.vue?ccc6","webpack:///F:/wechat-avatar/pages/main/index.vue?c283","webpack:///F:/wechat-avatar/pages/main/index.vue?f558","uni-app:///pages/main/index.vue","webpack:///F:/wechat-avatar/pages/main/index.vue?a62d","webpack:///F:/wechat-avatar/pages/main/index.vue?e4be"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,2F,6FAFmBA,EAAE,CAACC,iCAAH,GAAuCC,mBAAvC;AAGnBC,UAAU,CAACC,cAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA8H;AAC9H;AACyD;AACL;AACsC;;;AAG1F;AACqK;AACrK,gBAAgB,+KAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,4FAAM;AACR,EAAE,qGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,gGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,8TAEN;AACP;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACjDA;AAAA;AAAA;AAAA;AAA+lB,CAAgB,ynBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACuEnnB;AACA,4F;;;;;AAKA;AACA;AACA,oBADA,EADA;;AAIA,MAJA,kBAIA;AACA;AACA,wBADA;AAEA,gBAFA;AAGA,qBAHA;AAIA,wCAJA;AAKA,kBALA;AAMA,cANA;AAOA,qDAPA;AAQA,4IARA;AASA,sBATA;AAUA,qBAVA;AAWA,6DAXA;AAYA,uEAZA;AAaA,uBAbA,EAaA;AACA,sCAdA;AAeA,sCAfA;AAgBA,oCAhBA,EAgBA;AACA,oCAjBA,EAiBA;AACA,qBAlBA,EAkBA;AACA,+BAnBA;AAoBA,cApBA;AAqBA,eArBA;AAsBA,wCAtBA;AAuBA,wCAvBA;AAwBA,sCAxBA,EAwBA;AACA,sCAzBA,EAyBA;AACA,qBA1BA;AA2BA,sBA3BA;AA4BA,sBA5BA;AA6BA,gBA7BA;AA8BA,gBA9BA;AA+BA,kBA/BA;AAgCA,iCAhCA,EAgCA;AACA,oBAjCA;;AAmCA,GAxCA;AAyCA,QAzCA,oBAyCA;AACA;AACA;AACA,GA5CA;AA6CA,QA7CA,oBA6CA;AACA;AACA,GA/CA;AAgDA,SAhDA,qBAgDA;AACA;AACA;AACA;AACA;AACA,KAFA;AAGA,GAtDA;AAuDA,mBAvDA,+BAuDA;AACA;AACA,2CADA;AAEA,+CAFA;AAGA,+BAHA;;AAKA,GA7DA;AA8DA,iBA9DA,6BA8DA;AACA;AACA,2CADA;AAEA,+CAFA;AAGA,+BAHA;;AAKA,GApEA;AAqEA;AACA;;;AAGA,qBAJA,+BAIA;AACA;AACA,2BADA;AAEA,kBAFA;;AAIA;AACA,kBADA,CACA;AACA,0BADA;AAEA;AACA,0BADA,EAFA,EADA;;;AAOA,UAPA,CAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAdA;AAeA,WAfA,CAeA;AACA;AACA,2DADA;AAEA,2BAFA;;AAIA,OApBA;AAqBA,aArBA,CAqBA;AACA;AACA,OAvBA;AAwBA,KAjCA;AAkCA;;;;AAIA,iBAtCA,yBAsCA,EAtCA,EAsCA,GAtCA,EAsCA,KAtCA,EAsCA;AACA;AACA,2BADA;AAEA,kBAFA;;AAIA;AACA,kBADA,CACA;AACA,sBADA;AAEA;AACA,0BADA;AAEA,wBAFA,EAFA,EADA;;;AAQA,UARA,CAQA;AACA;AACA;AACA;AACA;AACA;AACA,WAFA,MAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OArBA;AAsBA,WAtBA,CAsBA;AACA;AACA,2DADA;AAEA,2BAFA;;AAIA,OA3BA;AA4BA,aA5BA,CA4BA;AACA;AACA,OA9BA;AA+BA,KA1EA;AA2EA;;;AAGA,QA9EA,kBA8EA;AACA,wCADA,SACA,WADA;AAEA,kEAFA;AAGA,KAjFA;AAkFA;;;;AAIA,kBAtFA,0BAsFA,IAtFA,EAsFA,GAtFA,EAsFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KA7FA;AA8FA;;;;AAIA,gBAlGA,wBAkGA,GAlGA,EAkGA;AACA;AACA;AACA;AACA;AACA;AACA,OAHA,MAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAJA;AAKA,KApHA;AAqHA;;;;AAIA,cAzHA,sBAyHA,CAzHA,EAyHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAHA,MAGA;AACA;AACA,OAFA,MAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KA1IA;AA2IA,aA3IA,qBA2IA,CA3IA,EA2IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAFA,MAEA;AACA;AACA,SAFA,MAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAjLA;AAkLA,YAlLA,oBAkLA,CAlLA,EAkLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KA7LA;AA8LA;;;AAGA,iBAjMA,yBAiMA,KAjMA,EAiMA;AACA;AACA,KAnMA;AAoMA;;;;AAIA,cAxMA,sBAwMA,IAxMA,EAwMA,KAxMA,EAwMA;AACA;AACA;AACA;AACA;AACA;AACA,KA9MA;AA+MA;;;AAGA,aAlNA,uBAkNA;AACA,6BADA,CACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KApOA;AAqOA;;;AAGA,iBAxOA,2BAwOA;AACA;AACA;AACA,4BADA;AAEA,iBAFA,mBAEA,GAFA,EAEA;AACA;AACA,WAJA;AAKA,cALA,gBAKA,GALA,EAKA;AACA;AACA,WAPA;;AASA,OAVA;AAWA,KApPA;AAqPA;;;AAGA,WAxPA,qBAwPA;AACA,kCADA;AAEA;AACA,yDADA;AAEA,8BAFA,IAFA;;;;AAQA;AACA,qCADA;AAEA,4BAFA;;AAIA,uBAZA,GAYA,yDAZA;AAaA,0BAbA,GAaA,iB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","file":"pages/main/index.js","sourcesContent":["import 'uni-pages';wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/main/index.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=255f3f96&scoped=true&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=255f3f96&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"255f3f96\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/main/index.vue\"\nexport default component.exports","export * from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.vue?vue&type=template&id=255f3f96&scoped=true&\"","var components\ntry {\n  components = {\n    lClipper: function() {\n      return import(\n        /* webpackChunkName: \"uni_modules/lime-clipper/components/l-clipper/l-clipper\" */ \"@/uni_modules/lime-clipper/components/l-clipper/l-clipper.vue\"\n      )\n    }\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  if (!_vm._isMounted) {\n    _vm.e0 = function($event) {\n      _vm.avatarImage = $event.url\n      _vm.showClipper = false\n    }\n\n    _vm.e1 = function($event) {\n      _vm.avatarImage = null\n      _vm.showClipper = false\n    }\n\n    _vm.e2 = function($event) {\n      _vm.currentIndex = -1\n      _vm.currentImage = {}\n    }\n  }\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"content\" @touchmove.stop @click.native=\"touchAvatarBg(false)\">\r\n\t\t<head-bar></head-bar>\r\n\t\t<image src=\"https://7463-tcb-htqvbkbv9bxahty751ffe-b59e59-1305947755.tcb.qcloud.la/background-image.png\"\r\n\t\t\tmode=\"aspectFit\" class=\"background-image\"></image>\r\n\r\n\t\t<view class=\"hideCanvas\">\r\n\t\t\t<canvas class=\"default_PosterCanvasId\"\r\n\t\t\t\t:style=\"{ width: imageScale * cansBorder + 'px', height: imageScale * cansBorder + 'px' }\"\r\n\t\t\t\tcanvas-id=\"default_PosterCanvasId\"></canvas>\r\n\t\t</view>\r\n\r\n\t\t<view class=\"image-card\">\r\n\t\t\t<view class=\"avatar-div\" id=\"avatar-container\" @click.stop>\r\n\t\t\t\t<image class=\"img\" id=\"avatar-img\" :src=\"avatarImage || defaultImage\" @click=\"touchAvatarBg(false)\">\r\n\t\t\t\t</image>\r\n\t\t\t\t<image v-if=\"currentImage && currentImage.image_url\" class=\"avatar-default\" :style=\"{\r\n\t\t\t\t\t\ttop: maskCenterY - maskSize / 2 - 2 + 'px',\r\n\t\t\t\t\t\tleft: maskCenterX - maskSize / 2 - 2 + 'px',\r\n\t\t\t\t\t\ttransform: 'rotate(' + rotate + 'deg)' + 'scale(' + scale + ')'\r\n\t\t\t\t\t}\" id=\"mask-img\" :src=\"currentImage.image_url\" @click=\"touchAvatarBg(false)\"></image>\r\n\t\t\t\t<!-- \t\t\t\t<view class=\"drag-div\"\r\n\t\t\t\t\t:style=\"{ top: handleCenterY - 10 + 'px', left: handleCenterX - 10 + 'px', width: handleWidth + 'rpx', height: handleWidth + 'rpx' }\"\r\n\t\t\t\t\tv-if=\"showBorder && currentImage && currentImage.drag_state\">\r\n\t\t\t\t\t<image class=\"drag-img\" id=\"drag-img\" src=\"/static/images/drag.svg\"></image>\r\n\t\t\t\t</view> -->\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<div class=\"load-image-buttons\">\r\n\t\t\t<div class=\"button-container\">\r\n\t\t\t\t<button class=\"load-image-button\" hover-class=\"load-image-button-hover\" open-type=\"getUserInfo\"\r\n\t\t\t\t\t@click.stop=\"getUserProfile('createImages')\"><span>Fetch</span></button>\r\n\t\t\t\t<div class=\"button-descripsion\">匹配当前头像<br>Fetch current avatar</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"button-container\">\r\n\t\t\t\t<button v-if=\"userInfo\" class=\"load-image-button\" hover-class=\"load-image-button-hover\"\r\n\t\t\t\t\t@click.stop=\"chooseImages('selectedImage')\"><span>Select</span></button>\r\n\t\t\t\t<button v-else class=\"load-image-button\" hover-class=\"load-image-button-hover\" open-type=\"getUserInfo\"\r\n\t\t\t\t\t@click.stop=\"getUserProfile('selectedImage')\"><span>Select</span></button>\r\n\t\t\t\t<div class=\"button-descripsion\">从相册选择<br>Select from albums</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<l-clipper v-if=\"showClipper\" :image-url=\"avatarImage\" @success=\"avatarImage = $event.url; showClipper = false\"\r\n\t\t\t@cancel=\"avatarImage = null; showClipper = false\" />\r\n\r\n\t\t<view class=\"image-selector\" @click.stop>\r\n\t\t\t<scroll-view scroll-x style=\"white-space: nowrap; width: 90%;\">\r\n\t\t\t\t<view class=\"image-div\">\r\n\t\t\t\t\t<view class=\"image-margin\" @click=\"currentIndex = -1; currentImage = {}\">\r\n\t\t\t\t\t\t<div class=\"place-holder\" :class=\"{'grey-border': currentIndex === -1}\">\r\n\t\t\t\t\t\t\t<image src=\"../../static/icon/cancel-icon.png\" style=\"width: 40px; height: 40px;\"></image>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"image-margin\" v-for=\"(info, index) in imageList\" :key=\"info._id\"\r\n\t\t\t\t\t\t@click=\"imageClick(info, index)\">\r\n\t\t\t\t\t\t<image :src=\"info.image_url\" :class=\"{'image-border': currentIndex === index}\"></image>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</scroll-view>\r\n\t\t</view>\r\n\r\n\t\t<button class=\"download-button\" hover-class=\"download-button-hover\" @click.stop=\"shareFc()\">\r\n\t\t\t<span>Download</span>\r\n\t\t\t<image src=\"@/static/icon/download-icon.png\" mode=\"aspectFit\"></image>\r\n\t\t</button>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport _app from '@/util/QS-SharePoster/app.js';\r\n\timport {\r\n\t\tgetSharePoster\r\n\t} from '@/util/QS-SharePoster/QS-SharePoster.js';\r\n\timport HeadBar from '@/components/HeadBar.vue'\r\n\r\n\texport default {\r\n\t\tcomponents: {\r\n\t\t\tHeadBar\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tshowClipper: false,\r\n\t\t\t\tposter: {},\r\n\t\t\t\tposterImage: '',\r\n\t\t\t\tcanvasId: 'default_PosterCanvasId',\r\n\t\t\t\tuserInfo: '',\r\n\t\t\t\tcode: '',\r\n\t\t\t\tavatarImage: uni.getStorageSync('avatar_image'),\r\n\t\t\t\tdefaultImage: 'https://vkceyugu.cdn.bspapp.com/VKCEYUGU-08ecbb66-149e-4d2b-93a0-fa6bc6e0e894/c33782ca-cd2f-4bfc-84eb-0713c52f522f.svg',\r\n\t\t\t\tcurrentImage: {},\r\n\t\t\t\tcurrentIndex: 0,\r\n\t\t\t\timageList: uni.getStorageSync('first_image_list') || [],\r\n\t\t\t\tcategoriesList: uni.getStorageSync('image_categories_list') || [],\r\n\t\t\t\tshowBorder: false, // 默认是否显示边框\r\n\t\t\t\tmaskCenterX: uni.upx2px(590) / 2,\r\n\t\t\t\tmaskCenterY: uni.upx2px(590) / 2,\r\n\t\t\t\thandleCenterX: uni.upx2px(560), // 360\r\n\t\t\t\thandleCenterY: uni.upx2px(570), // 360\r\n\t\t\t\thandleWidth: 50, // 360\r\n\t\t\t\tmaskSize: uni.upx2px(590),\r\n\t\t\t\tscale: 1,\r\n\t\t\t\trotate: 0,\r\n\t\t\t\tmask_center_x: uni.upx2px(590) / 2,\r\n\t\t\t\tmask_center_y: uni.upx2px(590) / 2,\r\n\t\t\t\thandle_center_x: uni.upx2px(560), // 360\r\n\t\t\t\thandle_center_y: uni.upx2px(570), // 360\r\n\t\t\t\tscaleCurrent: 1,\r\n\t\t\t\trotateCurrent: 0,\r\n\t\t\t\ttouch_target: '',\r\n\t\t\t\tstart_x: 0,\r\n\t\t\t\tstart_y: 0,\r\n\t\t\t\tstartInfo: 0,\r\n\t\t\t\tcansBorder: uni.upx2px(590), // 宽度 px\r\n\t\t\t\timageScale: 10,\r\n\t\t\t};\r\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\tthis.init();\r\n\t\t\tthis.getCategoriesList();\r\n\t\t},\r\n\t\tonShow() {\r\n\t\t\t// this.getShareInfo();\r\n\t\t},\r\n\t\tonReady() {\r\n\t\t\tconst query = wx.createSelectorQuery();\r\n\t\t\tquery.select('.avatar-div').boundingClientRect();\r\n\t\t\tquery.exec(res => {\r\n\t\t\t\tthis.startInfo = res[0];\r\n\t\t\t});\r\n\t\t},\r\n\t\tonShareAppMessage() {\r\n\t\t\treturn {\r\n\t\t\t\ttitle: getApp().globalData.shareTitle,\r\n\t\t\t\timageUrl: \"/static/images/share-card.png\",\r\n\t\t\t\tpath: \"/pages/main/index\"\r\n\t\t\t}\r\n\t\t},\r\n\t\tonShareTimeline() {\r\n\t\t\treturn {\r\n\t\t\t\ttitle: getApp().globalData.shareTitle,\r\n\t\t\t\timageUrl: \"/static/images/share-card.png\",\r\n\t\t\t\tpath: \"/pages/main/index\"\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t/**\r\n\t\t\t * 获取分类\r\n\t\t\t */\r\n\t\t\tgetCategoriesList() {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: 'Loading...',\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t});\r\n\t\t\t\tuniCloud\r\n\t\t\t\t\t.callFunction({\r\n\t\t\t\t\t\tname: 'categories',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\ttype: 'mpweixin'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\tthis.categoriesList = res.result.data;\r\n\t\t\t\t\t\tuni.setStorageSync('image_categories_list', res.result.data);\r\n\t\t\t\t\t\tif (this.categoriesList.length > 0) {\r\n\t\t\t\t\t\t\tthis.$set(this.categoriesList[0], 'selected', true);\r\n\t\t\t\t\t\t\tthis.getImagesList(this.categoriesList[0]._id, '', 'storage');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(err => {\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\tcontent: err.message || 'Fail to request service',\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.finally(() => {\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * @param {Object} id\r\n\t\t\t * 获取头像\r\n\t\t\t */\r\n\t\t\tgetImagesList(id, num, state) {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: 'Loading...',\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t});\r\n\t\t\t\tuniCloud\r\n\t\t\t\t\t.callFunction({\r\n\t\t\t\t\t\tname: 'images',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\ttype: 'mpweixin',\r\n\t\t\t\t\t\t\tcategoryId: id\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\tthis.imageList = res.result.data;\r\n\t\t\t\t\t\tstate === 'storage' && uni.setStorageSync('first_image_list', res.result.data);\r\n\t\t\t\t\t\tif (this.imageList && this.imageList.length > 0) {\r\n\t\t\t\t\t\t\tif (num < 0) {\r\n\t\t\t\t\t\t\t\tthis.currentImage = this.imageList[this.imageList.length - 1];\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.currentImage = this.imageList[0];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (!(this.currentImage && this.currentImage.drag_state)) {\r\n\t\t\t\t\t\t\t\tthis.initImage();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(err => {\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\tcontent: err.message || 'Fail to request service',\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.finally(() => {\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * 初始化\r\n\t\t\t */\r\n\t\t\tasync init() {\r\n\t\t\t\tthis.code = await this.getWeixinCode();\r\n\t\t\t\tthis.userInfo = uni.getStorageSync('user_info');\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * @param {Object} item\r\n\t\t\t * 切换分类\r\n\t\t\t */\r\n\t\t\tswitchCategory(item, num) {\r\n\t\t\t\tlet info = this.categoriesList.filter(el => el.selected);\r\n\t\t\t\tif (info && info.length > 0) {\r\n\t\t\t\t\tinfo[0].selected = false;\r\n\t\t\t\t}\r\n\t\t\t\tthis.$set(item, 'selected', true);\r\n\t\t\t\tthis.getImagesList(item._id, num);\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * @param {Object} num\r\n\t\t\t * 切换图片\r\n\t\t\t */\r\n\t\t\tswitchAvatar(num) {\r\n\t\t\t\tthis.touchAvatarBg(true);\r\n\t\t\t\tlet currentIndex = this.imageList.findIndex(el => el._id === this.currentImage._id);\r\n\t\t\t\tif ((num > 0 && currentIndex < this.imageList.length - 1) || (num < 0 && currentIndex > 0)) {\r\n\t\t\t\t\tcurrentIndex += num;\r\n\t\t\t\t\tthis.currentImage = this.imageList[currentIndex];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet currentType = this.categoriesList.findIndex(data => data.selected);\r\n\t\t\t\t\tcurrentType += num;\r\n\t\t\t\t\tif (this.categoriesList[currentType] && this.categoriesList[currentType]._id) {\r\n\t\t\t\t\t\tthis.switchCategory(this.categoriesList[currentType], num);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\tif (!(this.currentImage && this.currentImage.drag_state)) {\r\n\t\t\t\t\t\tthis.initImage();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * @param {Object} e\r\n\t\t\t * 设置挂件位置\r\n\t\t\t */\r\n\t\t\ttouchStart(e) {\r\n\t\t\t\tif (!(this.currentImage && this.currentImage.drag_state)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (e.target.id == 'mask-img') {\r\n\t\t\t\t\tthis.touch_target = 'mask-img';\r\n\t\t\t\t\tthis.showBorder = true;\r\n\t\t\t\t} else if (e.target.id == 'drag-img') {\r\n\t\t\t\t\tthis.touch_target = 'drag-img';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.touch_target = '';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.touch_target != '') {\r\n\t\t\t\t\tthis.start_x = e.touches[0].clientX;\r\n\t\t\t\t\tthis.start_y = e.touches[0].clientY;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\ttouchMove(e) {\r\n\t\t\t\tif (!(this.currentImage && this.currentImage.drag_state)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet current_x = e.touches[0].clientX;\r\n\t\t\t\tlet current_y = e.touches[0].clientY;\r\n\t\t\t\tlet moved_x = current_x - this.start_x;\r\n\t\t\t\tlet moved_y = current_y - this.start_y;\r\n\t\t\t\tif (this.touch_target === 'mask-img') {\r\n\t\t\t\t\tthis.maskCenterX = this.maskCenterX + moved_x;\r\n\t\t\t\t\tthis.maskCenterY = this.maskCenterY + moved_y;\r\n\t\t\t\t\tthis.handleCenterX = this.handleCenterX + moved_x;\r\n\t\t\t\t\tthis.handleCenterY = this.handleCenterY + moved_y;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.touch_target === 'drag-img') {\r\n\t\t\t\t\tthis.handleCenterX = this.handleCenterX + moved_x;\r\n\t\t\t\t\tthis.handleCenterY = this.handleCenterY + moved_y;\r\n\t\t\t\t\tlet diff_x_before = this.handle_center_x - this.mask_center_x;\r\n\t\t\t\t\tlet diff_y_before = this.handle_center_y - this.mask_center_y;\r\n\t\t\t\t\tlet diff_x_after = this.handleCenterX - this.mask_center_x;\r\n\t\t\t\t\tlet diff_y_after = this.handleCenterY - this.mask_center_y;\r\n\t\t\t\t\tlet distance_before = Math.sqrt(diff_x_before * diff_x_before + diff_y_before * diff_y_before);\r\n\t\t\t\t\tlet distance_after = Math.sqrt(diff_x_after * diff_x_after + diff_y_after * diff_y_after);\r\n\t\t\t\t\tlet angle_before = (Math.atan2(diff_y_before, diff_x_before) / Math.PI) * 180;\r\n\t\t\t\t\tlet angle_after = (Math.atan2(diff_y_after, diff_x_after) / Math.PI) * 180;\r\n\t\t\t\t\tthis.scale = (distance_after / distance_before) * this.scaleCurrent;\r\n\t\t\t\t\tthis.rotate = angle_after - angle_before + this.rotateCurrent;\r\n\t\t\t\t\tlet width = this.scale * 100;\r\n\t\t\t\t\tif (width > 50) {\r\n\t\t\t\t\t\tthis.handleWidth = 50;\r\n\t\t\t\t\t} else if (width < 10) {\r\n\t\t\t\t\t\tthis.handleWidth = 10;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.handleWidth = width;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.start_x = current_x;\r\n\t\t\t\tthis.start_y = current_y;\r\n\t\t\t},\r\n\t\t\ttouchEnd(e) {\r\n\t\t\t\tif (!(this.currentImage && this.currentImage.drag_state)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.mask_center_x = this.maskCenterX;\r\n\t\t\t\tthis.mask_center_y = this.maskCenterY;\r\n\t\t\t\tthis.handle_center_x = this.handleCenterX;\r\n\t\t\t\tthis.handle_center_y = this.handleCenterY;\r\n\t\t\t\tthis.touch_target = '';\r\n\t\t\t\tthis.scaleCurrent = this.scale;\r\n\t\t\t\tthis.rotateCurrent = this.rotate;\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * 不显示border\r\n\t\t\t */\r\n\t\t\ttouchAvatarBg(state) {\r\n\t\t\t\tthis.showBorder = state;\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * @param {Object} item\r\n\t\t\t * 图片点击事件\r\n\t\t\t */\r\n\t\t\timageClick(item, index) {\r\n\t\t\t\tthis.currentImage = item;\r\n\t\t\t\tthis.currentIndex = index;\r\n\t\t\t\tif (!(this.currentImage && this.currentImage.drag_state)) {\r\n\t\t\t\t\tthis.initImage();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * 还原设置\r\n\t\t\t */\r\n\t\t\tinitImage() {\r\n\t\t\t\tthis.showBorder = true; // 默认是否显示边框\r\n\t\t\t\tthis.maskCenterX = uni.upx2px(590) / 2;\r\n\t\t\t\tthis.maskCenterY = uni.upx2px(590) / 2;\r\n\t\t\t\tthis.handleCenterX = uni.upx2px(560);\r\n\t\t\t\tthis.handleCenterY = uni.upx2px(570);\r\n\t\t\t\tthis.maskSize = uni.upx2px(590);\r\n\t\t\t\tthis.scale = 1;\r\n\t\t\t\tthis.rotate = 0;\r\n\t\t\t\tthis.mask_center_x = uni.upx2px(590) / 2;\r\n\t\t\t\tthis.mask_center_y = uni.upx2px(590) / 2;\r\n\t\t\t\tthis.handle_center_x = uni.upx2px(560);\r\n\t\t\t\tthis.handle_center_y = uni.upx2px(570);\r\n\t\t\t\tthis.scaleCurrent = 1;\r\n\t\t\t\tthis.rotateCurrent = 0;\r\n\t\t\t\tthis.touch_target = '';\r\n\t\t\t\tthis.start_x = 0;\r\n\t\t\t\tthis.start_y = 0;\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * 获取微信code\r\n\t\t\t */\r\n\t\t\tgetWeixinCode() {\r\n\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\tuni.login({\r\n\t\t\t\t\t\tprovider: 'weixin',\r\n\t\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\t\tresolve(res.code);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\t\treject(new Error('Fail to login'));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * 生成新头像\r\n\t\t\t */\r\n\t\t\tasync shareFc() {\r\n\t\t\t\tif (!this.avatarImage) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: 'Please fetch your avatar first',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: 'Loading...',\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t});\r\n\t\t\t\tconst context = uni.createCanvasContext('default_PosterCanvasId', this);\r\n\t\t\t\tlet cansBorder = this.cansBorder;\r\n\t\t\t\tconst mask_size = this.scale * cansBorder;\r\n\t\t\t\tcontext.scale(this.imageScale, this.imageScale);\r\n\t\t\t\tcontext.clearRect(0, 0, this.cansBorder, this.cansBorder);\r\n\t\t\t\tuni.getImageInfo({\r\n\t\t\t\t\tsrc: this.avatarImage,\r\n\t\t\t\t\tsuccess: response1 => {\r\n\t\t\t\t\t\tcontext.drawImage(response1.path, 0, 0, cansBorder, cansBorder);\r\n\t\t\t\t\t\tuni.getImageInfo({\r\n\t\t\t\t\t\t\tsrc: this.currentImage.image_url,\r\n\t\t\t\t\t\t\tsuccess: response2 => {\r\n\t\t\t\t\t\t\t\tcontext.translate(this.mask_center_x, this.mask_center_y);\r\n\t\t\t\t\t\t\t\tcontext.rotate((this.rotate * Math.PI) / 180);\r\n\t\t\t\t\t\t\t\tcontext.drawImage(response2.path, -mask_size / 2, -mask_size /\r\n\t\t\t\t\t\t\t\t\t2, mask_size, mask_size);\r\n\t\t\t\t\t\t\t\tcontext.draw(false, () => {\r\n\t\t\t\t\t\t\t\t\tthis.saveCans();\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfail: () => {\r\n\t\t\t\t\t\t\t\tcontext.draw(false, () => {\r\n\t\t\t\t\t\t\t\t\tthis.saveCans();\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tsaveCans() {\r\n\t\t\t\tuni.canvasToTempFilePath({\r\n\t\t\t\t\t\tx: 0,\r\n\t\t\t\t\t\ty: 0,\r\n\t\t\t\t\t\theight: this.cansBorder * this.imageScale,\r\n\t\t\t\t\t\twidth: this.cansBorder * this.imageScale,\r\n\t\t\t\t\t\tdestWidth: this.cansBorder * this.imageScale,\r\n\t\t\t\t\t\tdestHeight: this.cansBorder * this.imageScale,\r\n\t\t\t\t\t\tcanvasId: this.canvasId,\r\n\t\t\t\t\t\tfileType: 'jpg',\r\n\t\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\t\tthis.posterImage = res.tempFilePath;\r\n\t\t\t\t\t\t\tthis.savefile();\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail(res) {\r\n\t\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tthis\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * 保存图片\r\n\t\t\t */\r\n\t\t\tsavefile() {\r\n\t\t\t\t//获取相册授权\r\n\t\t\t\tlet _self = this;\r\n\t\t\t\tuni.getSetting({\r\n\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\tif (!res.authSetting['scope.writePhotosAlbum']) {\r\n\t\t\t\t\t\t\tuni.authorize({\r\n\t\t\t\t\t\t\t\tscope: 'scope.writePhotosAlbum',\r\n\t\t\t\t\t\t\t\tsuccess() {\r\n\t\t\t\t\t\t\t\t\t//这里是用户同意授权后的回调\r\n\t\t\t\t\t\t\t\t\t_self.saveImgToLocal();\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tfail(e) {\r\n\t\t\t\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\t\t\t\twx.showModal({\r\n\t\t\t\t\t\t\t\t\t\tcontent: 'It is detected that image downloading function is not permitted. Do you want to enable it now ?',\r\n\t\t\t\t\t\t\t\t\t\tconfirmText: 'Yes',\r\n\t\t\t\t\t\t\t\t\t\tcancelText: 'No',\r\n\t\t\t\t\t\t\t\t\t\tsuccess: function(res) {\r\n\t\t\t\t\t\t\t\t\t\t\t//点击“确认”时打开设置页面\r\n\t\t\t\t\t\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\t\t\t\t\t\twx.openSetting();\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t//用户已经授权过了\r\n\t\t\t\t\t\t\t_self.saveImgToLocal();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * @param {Object} e\r\n\t\t\t * 保存到相册\r\n\t\t\t */\r\n\t\t\tsaveImgToLocal(e) {\r\n\t\t\t\tlet _self = this;\r\n\t\t\t\tuni.saveImageToPhotosAlbum({\r\n\t\t\t\t\tfilePath: _self.posterImage,\r\n\t\t\t\t\tsuccess: function() {\r\n\t\t\t\t\t\t// _self.saveImageInfo();\r\n\t\t\t\t\t\tuni.setStorageSync('currentImage', _self.posterImage);\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\t\turl: '/pages/save-success/index'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: e => {\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: 'Fail to save',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * 头像\r\n\t\t\t */\r\n\t\t\tsaveImageInfo() {\r\n\t\t\t\tuniCloud\r\n\t\t\t\t\t.callFunction({\r\n\t\t\t\t\t\tname: 'images',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\timageInfo: this.currentImage,\r\n\t\t\t\t\t\t\ttype: 'imageUsed'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\t\turl: '/pages/save-success/index'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * @param {Object} type\r\n\t\t\t * 获取头像\r\n\t\t\t */\r\n\t\t\tasync getUserProfile(type) {\r\n\t\t\t\tlet _this = this;\r\n\t\t\t\tuni.getUserProfile({\r\n\t\t\t\t\tdesc: 'Fetch avatar information',\r\n\t\t\t\t\tsuccess(result) {\r\n\t\t\t\t\t\tlet data = {\r\n\t\t\t\t\t\t\tcode: _this.code,\r\n\t\t\t\t\t\t\tsignature: result.signature,\r\n\t\t\t\t\t\t\tencrypted_data: result.encryptedData,\r\n\t\t\t\t\t\t\tiv: result.iv,\r\n\t\t\t\t\t\t\tuserInfo: result.userInfo\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tlet info = data.userInfo.avatarUrl;\r\n\t\t\t\t\t\tif (type === 'createImages') {\r\n\t\t\t\t\t\t\t_this.avatarImage = info.substring(0, info.lastIndexOf('/') + 1) + '0';\r\n\t\t\t\t\t\t\tuni.setStorageSync('avatar_image', _this.avatarImage);\r\n\t\t\t\t\t\t\t_this.showClipper = true\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t_this.postUserInfo(result.userInfo.nickName, type);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail(fall) {\r\n\t\t\t\t\t\tconsole.log(fall)\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ticon: 'error',\r\n\t\t\t\t\t\t\tposition: 'center',\r\n\t\t\t\t\t\t\ttitle: \"Fail to fetch avatar information\",\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * @param {Object} nickName\r\n\t\t\t * 存储用户数据\r\n\t\t\t */\r\n\t\t\tasync postUserInfo(nickName, type) {\r\n\t\t\t\tif (this.userInfo) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tlet that = this;\r\n\t\t\t\tthis.code = await this.getWeixinCode();\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: 'Loading...',\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t});\r\n\t\t\t\tuniCloud\r\n\t\t\t\t\t.callFunction({\r\n\t\t\t\t\t\tname: 'user_mpweixin',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\tcode: that.code,\r\n\t\t\t\t\t\t\tavatarImage: that.avatarImage,\r\n\t\t\t\t\t\t\tnickName,\r\n\t\t\t\t\t\t\ttype: 'userLogin'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\tuni.setStorageSync('user_info', res.result);\r\n\t\t\t\t\t\tthis.userInfo = res.result;\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\tif (type === 'selectedImage') {\r\n\t\t\t\t\t\t\tthis.chooseImages(type);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(err => {\r\n\t\t\t\t\t\tconsole.log(err)\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ticon: 'error',\r\n\t\t\t\t\t\t\tposition: 'center',\r\n\t\t\t\t\t\t\ttitle: \"Fail to store user information\",\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * 选择图片\r\n\t\t\t */\r\n\t\t\tchooseImages(type) {\r\n\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\tcount: 1, //默认9\r\n\t\t\t\t\tsizeType: ['original', 'compressed'], //可以指定是原图还是压缩图，默认二者都有\r\n\t\t\t\t\tsourceType: ['album', 'camera'], //从相册选择\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\t// let filePath = res.tempFilePaths[0];\r\n\t\t\t\t\t\tthis.avatarImage = res.tempFilePaths[0];\r\n\t\t\t\t\t\tthis.showClipper = true\r\n\t\t\t\t\t\t// uniCloud\r\n\t\t\t\t\t\t// \t.uploadFile({\r\n\t\t\t\t\t\t// \t\tfilePath: filePath,\r\n\t\t\t\t\t\t// \t\tcloudPath: `userChooseImage-${new Date().getTime()}.png`\r\n\t\t\t\t\t\t// \t})\r\n\t\t\t\t\t\t// \t.then(res => {\r\n\t\t\t\t\t\t// \t\t//获取到上传到云储存的url地址\r\n\t\t\t\t\t\t// \t\tuniCloud.getTempFileURL({\r\n\t\t\t\t\t\t// \t\t\tfileList: [res['fileID']]\r\n\t\t\t\t\t\t// \t\t}).then(res => {\r\n\t\t\t\t\t\t// \t\t\tthis.avatarImage = res.fileList[0].tempFileURL\r\n\t\t\t\t\t\t// \t\t})\r\n\t\t\t\t\t\t// \t\t//获取到上传到云储存的url地址\r\n\t\t\t\t\t\t// \t\tuniCloud\r\n\t\t\t\t\t\t// \t\t\t.callFunction({\r\n\t\t\t\t\t\t// \t\t\t\tname: 'user_mpweixin',\r\n\t\t\t\t\t\t// \t\t\t\tdata: {\r\n\t\t\t\t\t\t// \t\t\t\t\tuserId: this.userInfo._id,\r\n\t\t\t\t\t\t// \t\t\t\t\tavatarImage: this.avatarImage,\r\n\t\t\t\t\t\t// \t\t\t\t\ttype\r\n\t\t\t\t\t\t// \t\t\t\t}\r\n\t\t\t\t\t\t// \t\t\t})\r\n\t\t\t\t\t\t// \t\t\t.then();\r\n\t\t\t\t\t\t// \t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t}\r\n\t};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.content {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\twidth: 100vw;\r\n\t\theight: 100vh;\r\n\t\tpadding-top: 20px;\r\n\t\tbox-sizing: border-box;\r\n\r\n\t\t.background-image {\r\n\t\t\tposition: fixed;\r\n\t\t\tz-index: -1;\r\n\t\t\ttop: 50vh;\r\n\t\t\tleft: 50vw;\r\n\t\t\twidth: 312px;\r\n\t\t\theight: 356px;\r\n\t\t\ttransform: translate(-50%, -50%);\r\n\t\t}\r\n\r\n\t\t.image-selector {\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: center;\r\n\t\t\twidth: 100vw;\r\n\t\t\tbackground-color: rgba(255, 255, 255, 0.7);\r\n\t\t\tpadding: 30rpx 0;\r\n\t\t\tmargin-bottom: 40px;\r\n\t\t\tposition: relative;\r\n\r\n\t\t\t.image-div {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\r\n\t\t\t\t.place-holder {\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\tjustify-content: center;\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\t\twidth: 120rpx;\r\n\t\t\t\t\theight: 120rpx;\r\n\t\t\t\t\tbackground-color: #ffffff;\r\n\t\t\t\t}\r\n\r\n\t\t\t\timage {\r\n\t\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\t\twidth: 120rpx;\r\n\t\t\t\t\theight: 120rpx;\r\n\t\t\t\t\tflex-shrink: 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.image-margin:not(:last-child) {\r\n\t\t\t\t\tmargin-right: 30rpx;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.image-border {\r\n\t\t\t\t\tborder: 5rpx solid #ffffff;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t.grey-border {\r\n\t\t\t\t\tborder: 5rpx solid $uni-shadow-color;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.image-card {\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: center;\r\n\t\t\talign-items: center;\r\n\t\t\tposition: relative;\r\n\t\t\tbackground: rgba(255, 255, 255, 0.9);\r\n\t\t\twidth: 80vw;\r\n\t\t\theight: $avatar-size + 60rpx;\r\n\r\n\t\t\t.avatar-div {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\theight: $avatar-size;\r\n\t\t\t\twidth: $avatar-size;\r\n\t\t\t\t-webkit-box-orient: vertical;\r\n\t\t\t\t-webkit-box-direction: normal;\r\n\t\t\t\t-webkit-box-pack: center;\r\n\t\t\t\t-webkit-box-align: center;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\tz-index: 1;\r\n\r\n\t\t\t\t.img {\r\n\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\tbackground-color: $uni-bg-color-grey;\r\n\t\t\t\t\t// border-radius: $uni-border-radius-lg;\r\n\t\t\t\t\theight: 100%;\r\n\t\t\t\t\twidth: 100%;\r\n\t\t\t\t\tz-index: 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.avatar-default {\r\n\t\t\t\t\tbox-sizing: content-box;\r\n\t\t\t\t\t// border-radius: $uni-border-radius-lg;\r\n\t\t\t\t\theight: 100%;\r\n\t\t\t\t\twidth: 100%;\r\n\t\t\t\t\tmargin: 6rpx;\r\n\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\ttop: 0;\r\n\t\t\t\t\tleft: 0;\r\n\t\t\t\t\tz-index: 10;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.avatar-border {\r\n\t\t\t\t\tmargin: 0;\r\n\t\t\t\t\tborder: 6rpx dashed $theme-blue-one;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.drag-div {\r\n\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\ttop: $avatar-size;\r\n\t\t\t\t\tright: $avatar-size;\r\n\t\t\t\t\twidth: 50rpx;\r\n\t\t\t\t\theight: 50rpx;\r\n\t\t\t\t\tbackground-color: $theme-blue-three;\r\n\t\t\t\t\tborder-radius: $uni-border-radius-circle;\r\n\t\t\t\t\tpadding: 10rpx;\r\n\t\t\t\t\tz-index: 9999999;\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\tjustify-content: center;\r\n\t\t\t\t\talign-items: center;\r\n\r\n\t\t\t\t\t.drag-img {\r\n\t\t\t\t\t\twidth: 100%;\r\n\t\t\t\t\t\theight: 100%;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.load-image-buttons {\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: space-between;\r\n\t\t\twidth: 80vw;\r\n\t\t\tmargin: 30px 0;\r\n\r\n\t\t\t.button-container {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\talign-items: center;\r\n\r\n\t\t\t\t.load-image-button {\r\n\t\t\t\t\twidth: 120px;\r\n\t\t\t\t\theight: 35px;\r\n\t\t\t\t\tbackground-color: $theme-yellow;\r\n\t\t\t\t\tfont-style: normal;\r\n\t\t\t\t\tfont-weight: 600;\r\n\t\t\t\t\tfont-size: 16px;\r\n\t\t\t\t\tcolor: $uni-text-color-black;\r\n\t\t\t\t\tmargin-bottom: 10px;\r\n\t\t\t\t\ttransition: 0.3s;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.load-image-button-hover {\r\n\t\t\t\t\ttransform: scale(0.95);\r\n\t\t\t\t\ttransition: 0.3s;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.button-descripsion {\r\n\t\t\t\t\ttext-align: center;\r\n\t\t\t\t\tfont-size: 12px;\r\n\t\t\t\t\tline-height: 20px;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.download-button {\r\n\t\t\twidth: 200px;\r\n\t\t\theight: 40px;\r\n\t\t\tbackground-color: $theme-yellow;\r\n\t\t\tfont-style: normal;\r\n\t\t\tfont-weight: 600;\r\n\t\t\tfont-size: 16px;\r\n\t\t\tcolor: $uni-text-color-black;\r\n\t\t\ttransition: 0.3s;\r\n\r\n\t\t\tspan {\r\n\t\t\t\tmargin-right: 15px;\r\n\t\t\t}\r\n\r\n\t\t\timage {\r\n\t\t\t\twidth: 18px;\r\n\t\t\t\theight: 18px;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.download-button-hover {\r\n\t\t\ttransform: scale(0.95);\r\n\t\t\ttransition: 0.3s;\r\n\t\t}\r\n\r\n\t\t.hideCanvas {\r\n\t\t\tposition: fixed;\r\n\t\t\ttop: -99999upx;\r\n\t\t\tleft: -99999upx;\r\n\t\t\tz-index: -99999;\r\n\r\n\t\t\t.default_PosterCanvasId {\r\n\t\t\t\twidth: 1180rpx;\r\n\t\t\t\theight: 1180rpx;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t@keyframes d-light {\r\n\t\t0% {\r\n\t\t\ttransform: rotate(0deg);\r\n\t\t}\r\n\r\n\t\t25% {\r\n\t\t\ttransform: rotate(10deg);\r\n\t\t}\r\n\r\n\t\t75% {\r\n\t\t\ttransform: rotate(-10deg);\r\n\t\t}\r\n\r\n\t\t10% {\r\n\t\t\ttransform: rotate(0deg);\r\n\t\t}\r\n\t}\r\n</style>\n","import mod from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.vue?vue&type=style&index=0&id=255f3f96&lang=scss&scoped=true&\"; export default mod; export * from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.vue?vue&type=style&index=0&id=255f3f96&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1655807942044\n      var cssReload = require(\"E:/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}